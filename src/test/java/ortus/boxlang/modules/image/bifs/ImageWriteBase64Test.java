package ortus.boxlang.modules.image.bifs;

import static com.google.common.truth.Truth.assertThat;

import java.io.IOException;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import ortus.boxlang.runtime.BoxRuntime;
import ortus.boxlang.runtime.context.IBoxContext;
import ortus.boxlang.runtime.context.ScriptingRequestBoxContext;
import ortus.boxlang.runtime.scopes.IScope;
import ortus.boxlang.runtime.scopes.Key;
import ortus.boxlang.runtime.scopes.VariablesScope;

public class ImageWriteBase64Test {

	static BoxRuntime	instance;
	IBoxContext			context;
	IScope				variables;
	static Key			result	= new Key( "result" );

	@BeforeAll
	public static void setUp() {
		instance = BoxRuntime.getInstance( true );
	}

	@BeforeEach
	public void setupEach() {
		context		= new ScriptingRequestBoxContext( instance.getRuntimeContext() );
		variables	= context.getScopeNearby( VariablesScope.name );
	}

	@DisplayName( "It should return an image from a base64 string" )
	@Test
	public void testReadFromBase64() throws IOException {
		instance.executeSource(
		    """
		    result = ImageRead( "src/test/resources/logo.png" );
		      result = ImageWriteBase64( result, "png" );
		      """,
		    context );

		assertThat( variables.get( result ) ).isInstanceOf( String.class );
		assertThat( variables.get( result ) ).isEqualTo(
		    "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" );
	}
}
